import{H as f,J as y,I as S,R as I,U as d,N as s,m as l,Q as v}from"./index-7c4d6238.js";const F=()=>{const n=f(),{referal:g}=y(),u=S().search,c=new URLSearchParams(u).get("token"),i=v,{user:w,update:r}=I.useContext(d);return{login:async(t,{setSubmitting:a,resetForm:o})=>{localStorage.removeItem("token"),localStorage.removeItem("TWOFA"),sessionStorage.removeItem("email"),c&&await s("emailVerify",{},{Authorization:c}).then(e=>e!=null&&e.error?null:i({message:e.message,variant:"success"})),await s("login",t).then(e=>{sessionStorage.setItem("email",t.email),e!=null&&e.error?["Account Suspended","Your account banned","Your account suspended"].includes(e==null?void 0:e.message)?n("blocked",{state:{message:e==null?void 0:e.message}}):(e==null?void 0:e.message)==="Email Not Verified"?(sessionStorage.setItem("email",t.email),n(`${l.base}account/two-factor/verify`,{state:t})):i({message:e.message,variant:"error"}):(localStorage.getItem("TWOFA")&&(n(`${l.base}account/two-factor/true`),localStorage.removeItem("TWOFA")),r())}).finally(()=>{a(!1),o()})},register:async(t,{setSubmitting:a,resetForm:o})=>{localStorage.removeItem("token"),localStorage.removeItem("TWOFA"),sessionStorage.removeItem("email"),await s("regsiter",t).then(e=>{var m;localStorage.setItem("TWOFA","true"),sessionStorage.setItem("email",t.email),e!=null&&e.error?i({message:((m=e.message)==null?void 0:m.message)||e.message,variant:"error"}):(e!=null&&e.accessToken&&(localStorage.setItem("token",e.accessToken),console.log("JWT Token Saved:",e.accessToken)),e!=null&&e.user&&sessionStorage.setItem("email",e.user.email),n(`${l.base}account/two-factor/verify`,{state:t}),o())}).finally(()=>{a(!1)})},forgot:async(t,{setSubmitting:a,resetForm:o})=>{await s("resetUserEmail",t).then(e=>{e!=null&&e.error?i({message:e.message,variant:"error"}):n("success")}).finally(()=>{a(!1),o()})},reset:async(t,{setSubmitting:a,resetForm:o})=>{await s("changePassword",{...t,token:c}).then(e=>{e!=null&&e.error?i({message:e.message,variant:"error"}):n("success")}).finally(()=>{a(!1),o()})},sendMail:async()=>{const t=sessionStorage.getItem("email");console.log("📧 Register Mail - Email being used:",t);try{const a=await s("twoStepVerification",{email:t});return console.log("✅ OTP Sent - Response:",a),a}catch(a){throw console.error("❌ OTP Request Failed - Error:",a),a}},verify:async t=>{const a=await s("verifyEmail",{otp:t,email:sessionStorage.getItem("email")});console.log("VerifyOtp",a),a.error?i({message:a.message,variant:"error"}):(await s("emailVerify",{},{Authorization:a.accessToken}).then(o=>o!=null&&o.error?null:i({message:o.message,variant:"success"})),r(),n("success"))},referal:g,registerMail:async()=>{const t=sessionStorage.getItem("email");console.log("📧 Register Mail - Email being used:",t);try{const a=await s("twoStepVerification",{email:t});return console.log("✅ OTP Sent - Response:",a),a}catch(a){throw console.error("❌ OTP Request Failed - Error:",a),a}},registerVerify:async t=>{const a=await s("verifyEmail",{otp:t,email:sessionStorage.getItem("email")});a.error?i({message:a.message,variant:"error"}):(await s("emailVerify",{},{Authorization:a.accessToken}).then(o=>o!=null&&o.error?null:i({message:o.message,variant:"success"})),r(),n("success"))}}};export{F as u};
