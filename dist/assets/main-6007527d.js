import{b8 as E,j as e,t as v,S as c,T as l,G as b,P as G,A as N,F as T,R as $,U as z,$ as R,l as F,B as L,v as _,f as S,a0 as H,o as B,x as U,p as W,q as V,O as D,H as J,m as P}from"./index-7c4d6238.js";import{O as Y,a as K}from"./tableView-9476142e.js";import{u as O}from"./use-utils-2db32e46.js";import{R as Q}from"./recent-transactions-bffa7fc2.js";import{R as X}from"./responsive-table-51bed081.js";import{I as k}from"./intro-a059d009.js";import{C as q}from"./CopyAll-d6231e8c.js";import{F as Z}from"./FiberManualRecord-cb299172.js";import{B as ee}from"./ButtonGroup-4590fad5.js";import"./TableRow-2a5a6a71.js";import"./Pagination-2b50fa8d.js";const ne=()=>{const{data:i,isFetching:o}=E(["getUserTransactions",localStorage.getItem("accessToken")||""],"getUserTransactions");return{transactions:i,loading:o}},te=({coinWalletDetails:i,nativeCurrency:o,mainCurrency:h,nativePrice:p})=>{const x=(i==null?void 0:i.filter(({type:t,coin:d,currency:j})=>{const m=j===h||d===h;return console.log("Filtering by currency:",{type:t,coin:d,currency:j,match:m}),m}))||[],a=x.filter((t,d,j)=>{const m=d===j.findIndex(f=>f.typeId===t.typeId);return console.log("Filtering Unique:",{value:t,isUnique:m}),m}),s=a.length%2===0?a:[...a,{}];return console.log("Filtered By Currency:",x),console.log("Unique Filtered Data:",a),console.log("Final Data:",s),e.jsxs(v,{direction:"column",justifyContent:"start",spacing:2,sx:{height:"100%"},id:"coinDetails",children:[e.jsx(c,{direction:{xs:"column",md:"row",lg:"row"},justifyContent:"space-between",spacing:1,children:e.jsx(l,{variant:"h5",fontWeight:900,children:"Portfolio"})}),e.jsx(c,{sx:{width:"100%",overflow:"auto"},children:e.jsxs(b,{container:!0,gap:1.25,sx:{pb:2,width:`${310*(s.length/2)}px !important`,borderRadius:2,overflow:"auto"},children:[s.filter((t,d)=>d%2===0).map((t,d)=>t!=null&&t.coin?e.jsx(b,{item:!0,xs:!0,children:e.jsx(A,{coin:t.coinLogo,coinName:t.coin,balance:t.balance-Math.abs(t.freeze),amountType:o,amount:t.current_price*p})},d):null),s.filter((t,d)=>d%2===1).map((t,d)=>t!=null&&t.coin?e.jsx(b,{item:!0,xs:!0,children:e.jsx(A,{coin:t.coinLogo,coinName:t.coin,balance:t.balance-Math.abs(t.freeze),amountType:o,amount:t.current_price*p})},d):null)]})})]})},A=({coin:i,coinName:o,balance:h,amountType:p,amount:x})=>e.jsxs(c,{direction:"row",alignItems:"center",component:G,gap:4,sx:{p:1.25,width:293,height:90,borderRadius:2,border:"1px solid #eeeeee",bgcolor:a=>a.palette.mode==="dark"?void 0:"#fff"},children:[e.jsx(c,{children:e.jsx(c,{direction:"row",spacing:1,children:e.jsx(N,{src:`https://api.sun100.io${i}`,sx:{height:35,width:35}})})}),e.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"baseline",width:"100%",children:[e.jsxs(c,{spacing:1,gap:1.25,children:[e.jsx(c,{direction:"row",spacing:1,children:e.jsx(l,{variant:"body1",children:o})}),e.jsx(c,{direction:"row",gap:2,children:e.jsx(l,{variant:"h6",noWrap:!0,sx:{fontWeight:800,fontSize:"18px"},children:e.jsx(T,{type:p,number:x})})})]}),e.jsx(l,{variant:"h6",sx:{fontWeight:800,fontSize:"18px"},children:e.jsx(T,{type:"number",number:h})})]})]}),ie=({account:i,trades:o,p2p_trades:h,logs:p,contentCopy:x})=>{var w,r,u;const{user:a}=$.useContext(z),[s,t]=$.useState("spot"),[d,j]=$.useState(""),m=n=>j(n.target.value);h&&h.filter(n=>`${n.coin} ${n.currency} ${n.noOfCoins} ${n.pricePerCoin} ${n.prefferedPayment} ${n.status}`.toLowerCase().includes(d.toLowerCase())).map(n=>{const y=n.orderType==="buy"&&(n==null?void 0:n.uid)===(a==null?void 0:a.uid)||n.orderType==="sell"&&(n==null?void 0:n.requestuid)!==(a==null?void 0:a.uid);return{id:e.jsxs(c,{direction:"row",alignItems:"center",children:[e.jsxs(l,{variant:"inherit",width:100,noWrap:!0,children:[n.tradeId," "]}),e.jsx(R,{size:"small",onClick:()=>x(n.tradeId),children:e.jsx(q,{fontSize:"inherit",color:"primary"})})]}),date:n.showPostTill,type:e.jsx(l,{sx:{bgcolor:g=>y?`${g.palette.success.light}30`:`${g.palette.error.light}30`,py:.5,px:2,borderRadius:1,width:"fit-content",textTransform:"capitalize"},color:y?"success.light":"error.light",variant:"inherit",children:y?"Buy":"Sell"}),pair:`${n.coin}-${n.currency}`,limit:`${n.quantityLimitFrom}-${n.quantityLimitTo}`,quantity:n.requestCoins,paymentType:+n.prefferedPayment==0?"All Payments":n.prefferedPayment,status:e.jsxs(c,{direction:"row",children:[e.jsx(Z,{color:{cancelled:"error",pending:"error",partiallyPending:"error",dispute:"error",declined:"error",expired:"warning",ongoing:"warning",confirm:"success",confirmed:"success",completed:"success",undefined:void 0}[n==null?void 0:n.requestStatus],sx:{width:8,mx:.5}}),e.jsx(l,{color:{cancelled:"error.main",dispute:"error.main",pending:"error.main",partiallyPending:"error.main",declined:"error.main",expired:"warning.main",ongoing:"warning.main",confirm:"success.main",confirmed:"success.main",completed:"success.main"}[n==null?void 0:n.requestStatus],variant:"body2",sx:{textTransform:"capitalize"},children:n.requestStatus})]})}});const f=p?p.sort((n,y)=>y.time-n.time).filter(n=>`${n.tokenId} ${n.logType} ${n.from} ${n.to} ${n.price}`.toLowerCase().includes(d.toLowerCase())).map(n=>({date:n.time,id:`# ${n.tokenId}`,contract:e.jsxs(c,{direction:"row",alignItems:"center",children:[e.jsxs(l,{variant:"inherit",width:100,noWrap:!0,children:[n.contract," "]}),e.jsx(R,{size:"small",onClick:()=>x(n.contract),children:e.jsx(q,{fontSize:"inherit",color:"primary"})})]}),logType:e.jsx(l,{variant:"inherit",textTransform:"capitalize",children:n.logType}),from:n.from,to:n.to,price:e.jsx(T,{type:"coin",number:n.price,coin:"ETH"}),gasFee:e.jsx(T,{type:"coin",number:n.fee,coin:"ETH"})})):[];return e.jsxs(v,{direction:"column",spacing:2,customTitle:e.jsxs(c,{sx:{width:"100%"},children:[e.jsx(l,{variant:"h6",flexGrow:0,fontWeight:900,children:"Trade History"}),e.jsxs(c,{direction:{xs:"column",md:"row"},alignItems:"center",spacing:1,sx:{width:"100%"},children:[e.jsx(ee,{id:"tradeHistoryNavigations",sx:{overflow:"hidden",width:"fit-content",bgcolor:"background.default"},children:e.jsxs(F,{variant:"text",onClick:()=>t("spot"),sx:{color:s==="spot"?"primary.main":"text.secondary",position:"relative",px:3,fontWeight:"bold"},children:["Spot"," ",(w=o==null?void 0:o.filter(({status:n})=>["completed","FILLED","done"].includes(n)))!=null&&w.length?`(${(r=o==null?void 0:o.filter(({status:n})=>["completed","FILLED","done"].includes(n)))==null?void 0:r.length})`:"",s==="spot"&&e.jsx(L,{sx:{position:"absolute",bottom:0,width:50,borderRadius:2,borderBottom:n=>`2px solid ${n.palette.primary.main}`}})]})}),e.jsx(L,{flexGrow:1}),e.jsx(_,{size:"small",value:d,onChange:m,placeholder:"Filter records",InputProps:{startAdornment:e.jsx(S,{component:"img",src:"images/search.png",sx:{width:25,height:25}})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"20px","& .MuiOutlinedInput-input":{padding:"10px 14px"}}}})]})]}),children:[{spot:e.jsx(Y,{trades:(u=o.filter(n=>`${n.baseAsset} ${n.quoteAsset} ${H[(n.orderType||n.orderTypeId)-1]} ${n.noOfCoins} ${(n==null?void 0:n.noOfCoinsAsset)||(n==null?void 0:n.coin)} ${["FILLED","done"].includes(n.status)?"completed":n.status}`.toLowerCase().includes(d.toLowerCase())))==null?void 0:u.filter(({status:n})=>["completed","FILLED","done"].includes(n)),type:"trades"}),token:i?e.jsx(X,{titles:["Time","Token ID","Contract","Log Type","From","To","Price","Gas Fee"],data:f}):e.jsx(c,{justifyContent:"center",alignItems:"center",children:window.ethereum?e.jsx(se,{}):e.jsx(oe,{})})}[s],e.jsx(L,{flexGrow:1})]})},fe=()=>{const{user:i,coinWalletDetails:o,amountWalletDetails:h,nativeCurrency:p,mainCurrency:x,nativePrice:a,loading:s,account:t,logs:d}=$.useContext(z),{contentCopy:j}=O(),{transactions:m,loading:f}=ne(),{trades:w,loading:r}=K(i==null?void 0:i.uid),{data:u}=B("collection","p2p_trade_book").collectionSnapshot(),{data:n}=B("collectionGroup","p2p_request_trades").collectionSnapshot([U("requestPlacedTime","asc")]),y=n?n.map(({uid:g,...I})=>{const C=u==null?void 0:u.find(({tradeId:M})=>M===I.requestTradeId);return{...C,...I,orderType:g===(i==null?void 0:i.uid)?(C==null?void 0:C.orderType)==="buy"?"sell":"buy":C==null?void 0:C.orderType}}).filter(({coin:g})=>!!g):[];return s||f||r||y===void 0?e.jsx(W,{}):e.jsxs(V,{maxWidth:"xl",sx:{px:{xs:2,md:5},pb:5},children:[e.jsx(k,{name:"dashboard"}),e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:12,md:3,children:e.jsx(re,{coinWalletDetails:o,amountWalletDetails:h,nativeCurrency:p,mainCurrency:x,nativePrice:a})}),e.jsx(b,{item:!0,xs:12,md:9,children:e.jsx(te,{coinWalletDetails:o,nativeCurrency:p,mainCurrency:x,nativePrice:a})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(Q,{transactions:m.transactions})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(ie,{contentCopy:j,account:t,trades:w,p2p_trades:y.filter(({requestuid:g,uid:I})=>[g,I].includes(i==null?void 0:i.uid)).sort((g,I)=>I.requestPlacedTime-g.requestPlacedTime),logs:d})})]}),e.jsx(D,{})]})},se=()=>{const{account:i,balance:o,connect:h,authenticated:p,syncedAccount:x}=$.useContext(z),{contentCopy:a}=O();return i?e.jsx(e.Fragment,{children:e.jsxs(c,{id:"metamaskBalance",sx:{borderRadius:5,border:s=>`1px solid ${s.palette.grey[200]}`,p:1},children:[e.jsx(k,{name:"nftBalance"}),e.jsxs(c,{direction:"row",alignItems:"center",children:[e.jsxs(l,{variant:"inherit",width:200,noWrap:!0,children:["ID: ",i," "]}),e.jsx(R,{size:"small",onClick:()=>a(i),children:e.jsx(q,{fontSize:"inherit",color:"primary"})})]}),e.jsx(l,{variant:"body2",color:"primary",children:p?e.jsxs(e.Fragment,{children:["Balance:"," ",e.jsx(T,{number:o,type:"coin",coin:"ETH"})]}):x?"Account not synced with this user":""})]})}):e.jsxs(F,{id:"connectMetamask",variant:"outlined",sx:{borderRadius:20,width:"fit-content",height:"fit-content"},onClick:h,children:[e.jsx(k,{name:"nftConnect"}),"Connect to Wallet"]})},oe=()=>e.jsx(F,{variant:"outlined",sx:{borderRadius:20},download:!0,href:"https://metamask.io/download.html",children:"Install MetaMask"}),re=({coinWalletDetails:i,amountWalletDetails:o,nativeCurrency:h,mainCurrency:p,nativePrice:x})=>{var m,f,w;const a=J(),s=(o==null?void 0:o.find(({typeId:r})=>r===p))||{balance:0,freeze:0,typeId:p},t=(w=(f=(m=i==null?void 0:i.filter(({currency:r})=>r===p))==null?void 0:m.filter(({type:r})=>r==="COIN"))==null?void 0:f.map(r=>r.current_price*(r.balance-Math.abs(r.freeze))*x))==null?void 0:w.reduce((r,u)=>r+u,0),d=()=>{var r;return a(`${P.base}wallet/deposit`,{state:{...s,coinId:(r=i.find(({type:u})=>u==="COIN"))==null?void 0:r.coinId}})},j=()=>{var r;return a(`${P.base}wallet/withdraw`,{state:{...s,coinId:(r=i.find(({type:u})=>u==="COIN"))==null?void 0:r.coinId}})};return e.jsxs(v,{direction:"column",spacing:2,id:"mainCurrency",sx:{height:"100%"},children:[e.jsx(c,{direction:"row",alignItems:"center",gap:1.5,children:e.jsx(l,{variant:"h6",noWrap:!0,sx:{color:"#818898"},children:"Available Balance"})}),e.jsxs(c,{direction:"row",justifyContent:"space-between",sx:{mt:0},children:[e.jsx(l,{variant:"h5",fontWeight:700,children:e.jsx(T,{type:"number",number:s.balance-Math.abs(s.freeze)})}),e.jsx(l,{variant:"h5",sx:{color:"#005E00",opacity:.8},children:s==null?void 0:s.typeId})]}),e.jsx(c,{children:e.jsx(l,{variant:"h6",noWrap:!0,sx:{color:"#818898"},children:"Total Asset Value"})}),e.jsx(c,{direction:"row",justifyContent:"space-between",children:e.jsx(l,{variant:"h5",children:e.jsx(T,{type:h,number:t+(s.balance-Math.abs(s.freeze))*x})})}),e.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,children:[e.jsx(F,{id:"mainCurrencyDeposit",variant:"contained",size:"small",sx:{bgcolor:"#00C566",borderRadius:2.5,py:1.25,px:3,"&:hover":{bgcolor:"#00C566",boxShadow:"none"}},onClick:d,startIcon:e.jsx(S,{src:"images/Deposit.png",component:"img",sx:{width:20,height:20}}),children:"Deposit"}),e.jsx(F,{id:"mainCurrencyWithdraw",disabled:(s==null?void 0:s.balance)-Math.abs(s==null?void 0:s.freeze)<=0,variant:"contained",size:"small",sx:{bgcolor:"#FCB923",borderRadius:2.5,py:1.25,px:3,"&:hover":{bgcolor:"#FCB923",boxShadow:"none"}},startIcon:e.jsx(S,{src:"images/Withdraw.png",component:"img",sx:{width:20,height:20}}),onClick:j,children:"Withdraw"})]})]})};export{fe as default};
